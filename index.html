<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión Académica - Feli</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"> 
    <link rel="icon" type="image/png" href="https://img.icons8.com/external-glyph-geotatah/64/982036/external-academic-knowledge-management-glyph-glyph-geotatah.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #ffffff;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #a3223a, #8a1d30);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo-text p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav {
            background: white;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-container::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            color: #a3223a;
            background: #f8f9fa;
        }

        .nav-btn.active {
            color: #a3223a;
            border-bottom-color: #a3223a;
            background: #fff5f5;
        }

        /* Main Content */
        .main {
            padding: 30px 0;
            min-height: calc(100vh - 200px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: #a3223a;
        }

        /* Buttons */
        .btn {
            background: #a3223a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            background: #8a1d30;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(163, 34, 58, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #a3223a;
            box-shadow: 0 0 0 3px rgba(163, 34, 58, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #a3223a;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #a3223a;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        /* Progress Bar */
        .progress-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
            margin: 15px 0;
        }

        .progress-bar {
            background: linear-gradient(90deg, #a3223a, #c73650);
            height: 20px;
            border-radius: 6px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Materia Item */
        .materia-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .materia-item:hover {
            border-color: #a3223a;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .materia-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .materia-code {
            background: #a3223a;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .materia-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .materia-note {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a3223a;
            margin: 10px 0;
        }

        .materia-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Task Item */
        .task-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .task-item.completed {
            opacity: 0.7;
            border-color: #28a745;
        }

        .task-item.completed .task-name {
            text-decoration: line-through;
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 10px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            margin-top: 2px;
        }

        .task-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .task-priority {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .priority-alta {
            background: #dc3545;
            color: white;
        }

        .priority-media {
            background: #ffc107;
            color: #333;
        }

        .priority-baja {
            background: #28a745;
            color: white;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        /* Schedule */
        .schedule-container {
            overflow-x: auto;
        }

        .schedule-table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .schedule-table th {
            background: #a3223a;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
        }

        .schedule-table td {
            border: 1px solid #e9ecef;
            padding: 8px;
            text-align: center;
            vertical-align: top;
            height: 60px;
            position: relative;
        }

        .schedule-table .time-cell {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
        }

        .schedule-event {
            background: #a3223a;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin: 1px 0;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }

        .modal-close:hover {
            color: #333;
        }

        /* Motivational Quote */
        .quote-card {
            background: linear-gradient(135deg, #a3223a, #c73650);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .quote-text {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 10px;
            font-style: italic;
        }

        .quote-day {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .header-content {
                text-align: center;
            }

            .logo {
                justify-content: center;
                margin-bottom: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .materia-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .task-header {
                flex-direction: column;
                gap: 10px;
            }

            .task-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .modal-content {
                padding: 20px;
                margin: 20px;
            }
        }

        /* Exam Item */
        .exam-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .exam-item:hover {
            border-color: #a3223a;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .exam-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .exam-type.parcial {
            background: #17a2b8;
            color: white;
        }

        .exam-type.final {
            background: #a3223a;
            color: white;
        }

        .exam-type.recuperatorio {
            background: #ffc107;
            color: #333;
        }

        .exam-note {
            font-size: 1.8rem;
            font-weight: 700;
            color: #a3223a;
            margin: 10px 0;
        }

        .exam-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .year-section {
            margin-bottom: 30px;
        }

        .year-title {
            background: linear-gradient(135deg, #a3223a, #c73650);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Materia Details */
        .materia-details {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #a3223a;
        }

        .materia-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
        }

        .info-value {
            font-weight: 600;
            color: #333;
        }

        .notas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .nota-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .nota-label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 3px;
        }

        .nota-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #a3223a;
        }

        .promedio-final {
            background: linear-gradient(135deg, #a3223a, #c73650);
            color: white;
            border: none;
        }

        .promedio-final .nota-label {
            color: rgba(255,255,255,0.9);
        }

        .promedio-final .nota-value {
            color: white;
            font-size: 1.3rem;
        }

        .estado-materia {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .estado-aprobada {
            background: #28a745;
            color: white;
        }

        .estado-regular {
            background: #ffc107;
            color: #333;
        }

        .estado-libre {
            background: #dc3545;
            color: white;
        }

        .estado-cursando {
            background: #17a2b8;
            color: white;
        }

        /* Utilities */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #a3223a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-laptop-code"></i>
                    <div class="logo-text">
                        <h1>Gestión Académica UBP</h1>
                        <p>Ingeniería Informática</p>
                    </div>
                </div>
                <div class="user-info">
                    <p><strong>Estudiante:</strong> <span id="studentName">FELIPE LEAL</span></p>
                    <p><strong>Legajo:</strong> <span id="studentId">177640</span></p>
                </div>
            </div>
        </div>
        </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-container">
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showSection('materias')">
                    <i class="fas fa-book"></i> Materias
                </button>
                <button class="nav-btn" onclick="showSection('tareas')">
                    <i class="fas fa-tasks"></i> Tareas
                </button>
                <button class="nav-btn" onclick="showSection('horario')">
                    <i class="fas fa-calendar"></i> Horario
                </button>
                <button class="nav-btn" onclick="showSection('examenes')">
                    <i class="fas fa-clipboard-list"></i> Exámenes
                </button>
                <button class="nav-btn" onclick="showSection('progreso')">
                    <i class="fas fa-chart-line"></i> Progreso
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <!-- Motivational Quote -->
                <div class="quote-card">
                    <div class="quote-text" id="dailyQuote">¡Bienvenido a tu gestor académico!</div>
                    <div class="quote-day" id="quoteDay">Cargando frase del día...</div>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMaterias">0</div>
                        <div class="stat-label">Materias Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="materiasAprobadas">0</div>
                        <div class="stat-label">Materias Aprobadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="promedioGeneral">0.0</div>
                        <div class="stat-label">Promedio General</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tareasPendientes">0</div>
                        <div class="stat-label">Tareas Pendientes</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-clock"></i>
                            Actividad Reciente
                        </h2>
                    </div>
                    <div id="recentActivity">
                        <p style="color: #666; text-align: center; padding: 20px;">
                            No hay actividad reciente. ¡Comienza agregando materias y tareas!
                        </p>
                    </div>
                </div>
            </section>

            <!-- Materias Section -->
            <section id="materias" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-book"></i>
                            Mis Materias
                        </h2>
                        <button class="btn" onclick="openModal('materiaModal')">
                            <i class="fas fa-plus"></i>
                            Agregar Materia
                        </button>
                    </div>
                    <div id="materiasList" class="grid grid-3">
                        <!-- Materias will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Tareas Section -->
            <section id="tareas" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-tasks"></i>
                            Mis Tareas
                        </h2>
                        <button class="btn" onclick="openModal('tareaModal')">
                            <i class="fas fa-plus"></i>
                            Agregar Tarea
                        </button>
                    </div>
                    <div id="tareasList">
                        <!-- Tareas will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Horario Section -->
            <section id="horario" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-calendar"></i>
                            Mi Horario Semanal
                        </h2>
                        <button class="btn" onclick="openModal('horarioModal')">
                            <i class="fas fa-plus"></i>
                            Agregar Clase
                        </button>
                    </div>
                    <div class="schedule-container">
                        <table class="schedule-table" id="scheduleTable">
                            <!-- Schedule will be generated here -->
                        </table>
                    </div>
                </div>
            </section>

            <!-- Exámenes Section -->
            <section id="examenes" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-clipboard-list"></i>
                            Mis Exámenes
                        </h2>
                        <button class="btn" onclick="openModal('examenModal')">
                            <i class="fas fa-plus"></i>
                            Registrar Examen
                        </button>
                    </div>
                    <div id="examenesList">
                        <!-- Exámenes will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Progreso Section -->
            <section id="progreso" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Mi Progreso Académico
                        </h2>
                    </div>
                    
                    <div class="mb-20">
                        <h3 style="margin-bottom: 10px;">Progreso General de la Carrera</h3>
                        <div class="progress-container">
                            <div class="progress-bar" id="careerProgress" style="width: 0%"></div>
                        </div>
                        <p style="text-align: center; margin-top: 10px; color: #666;">
                            <span id="progressText">0% completado</span>
                        </p>
                    </div>

                    <div class="grid grid-2">
                        <div>
                            <h3 style="margin-bottom: 15px;">Materias por Estado</h3>
                            <div id="materiasStatus">
                                <!-- Status will be loaded here -->
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px;">Distribución de Notas</h3>
                            <div id="notasDistribution">
                                <!-- Distribution will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <!-- Materia Modal -->
    <div id="materiaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agregar Materia</h3>
                <button class="modal-close" onclick="closeModal('materiaModal')">&times;</button>
            </div>
            <form id="materiaForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Código de la Materia</label>
                        <input type="text" id="materiaCodigo" class="form-input" placeholder="Ej: INF-101" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Año</label>
                        <select id="materiaAno" class="form-input" required>
                            <option value="">Seleccionar año...</option>
                            <option value="1">1er Año</option>
                            <option value="2">2do Año</option>
                            <option value="3">3er Año</option>
                            <option value="4">4to Año</option>
                            <option value="5">5to Año</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Cuatrimestre</label>
                    <select id="materiaCuatrimestre" class="form-input" required>
                        <option value="">Seleccionar cuatrimestre...</option>
                        <option value="1">1er Cuatrimestre</option>
                        <option value="2">2do Cuatrimestre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre de la Materia</label>
                    <input type="text" id="materiaNombre" class="form-input" placeholder="Ej: Programación I" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Materia Correlativa (Opcional)</label>
                    <select id="materiaCorrelativa" class="form-input">
                        <option value="">Sin correlativa...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notas de Parciales</label>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Parcial 1 (1-10)</label>
                            <input type="number" id="materiaParcial1" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parcial 2 (1-10)</label>
                            <input type="number" id="materiaParcial2" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                        </div>
                    </div>
                    <div id="parcialesExtra"></div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="agregarParcial()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Agregar Parcial
                    </button>
                </div>
                <div class="form-group">
                    <label class="form-label">Exámenes Finales</label>
                    <div id="finalesContainer">
                        <div class="form-row" style="margin-bottom: 10px;">
                            <div class="form-group">
                                <label class="form-label">1er Llamado (1-10)</label>
                                <input type="number" id="materiaFinal1" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fecha 1er Llamado</label>
                                <input type="date" id="materiaFinalFecha1" class="form-input">
                            </div>
                        </div>
                    </div>
                    <div id="finalesExtra"></div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="agregarFinal()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Agregar Llamado
                    </button>
                </div>
                <div class="form-group">
                    <label class="form-label">Comentarios</label>
                    <textarea id="materiaComentarios" class="form-input" rows="3" placeholder="Comentarios adicionales..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('materiaModal')">Cancelar</button>
                    <button type="submit" class="btn">Guardar Materia</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tarea Modal -->
    <div id="tareaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agregar Tarea</h3>
                <button class="modal-close" onclick="closeModal('tareaModal')">&times;</button>
            </div>
            <form id="tareaForm">
                <div class="form-group">
                    <label class="form-label">Nombre de la Tarea</label>
                    <input type="text" id="tareaNombre" class="form-input" placeholder="Ej: Trabajo Práctico 1" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Materia Asociada</label>
                    <select id="tareaMateria" class="form-input" required>
                        <option value="">Seleccionar materia...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fecha Límite</label>
                        <input type="date" id="tareaFecha" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prioridad</label>
                        <select id="tareaPrioridad" class="form-input" required>
                            <option value="">Seleccionar...</option>
                            <option value="alta">Alta</option>
                            <option value="media">Media</option>
                            <option value="baja">Baja</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('tareaModal')">Cancelar</button>
                    <button type="submit" class="btn">Guardar Tarea</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Horario Modal -->
    <div id="horarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agregar Clase</h3>
                <button class="modal-close" onclick="closeModal('horarioModal')">&times;</button>
            </div>
            <form id="horarioForm">
                <div class="form-group">
                    <label class="form-label">Materia</label>
                    <select id="horarioMateria" class="form-input" required>
                        <option value="">Seleccionar materia...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Día</label>
                        <select id="horarioDia" class="form-input" required>
                            <option value="">Seleccionar día...</option>
                            <option value="lunes">Lunes</option>
                            <option value="martes">Martes</option>
                            <option value="miercoles">Miércoles</option>
                            <option value="jueves">Jueves</option>
                            <option value="viernes">Viernes</option>
                            <option value="sabado">Sábado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aula</label>
                        <input type="text" id="horarioAula" class="form-input" placeholder="Ej: A-101">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Hora Inicio</label>
                        <input type="time" id="horarioInicio" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hora Fin</label>
                        <input type="time" id="horarioFin" class="form-input" required>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('horarioModal')">Cancelar</button>
                    <button type="submit" class="btn">Guardar Clase</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Examen Modal -->
    <div id="examenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Examen</h3>
                <button class="modal-close" onclick="closeModal('examenModal')">&times;</button>
            </div>
            <form id="examenForm">
                <div class="form-group">
                    <label class="form-label">Materia</label>
                    <select id="examenMateria" class="form-input" required>
                        <option value="">Seleccionar materia...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo de Examen</label>
                        <select id="examenTipo" class="form-input" required>
                            <option value="">Seleccionar tipo...</option>
                            <option value="parcial">Parcial</option>
                            <option value="final">Final</option>
                            <option value="recuperatorio">Recuperatorio</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fecha del Examen</label>
                        <input type="date" id="examenFecha" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Nota Obtenida (1-10)</label>
                    <input type="number" id="examenNota" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                </div>
                <div class="form-group">
                    <label class="form-label">Observaciones</label>
                    <textarea id="examenObservaciones" class="form-input" rows="3" placeholder="Comentarios sobre el examen..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('examenModal')">Cancelar</button>
                    <button type="submit" class="btn">Guardar Examen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Materia Modal -->
    <div id="editMateriaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Materia</h3>
                <button class="modal-close" onclick="closeModal('editMateriaModal')">&times;</button>
            </div>
            <form id="editMateriaForm">
                <input type="hidden" id="editMateriaId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Código de la Materia</label>
                        <input type="text" id="editMateriaCodigo" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Año</label>
                        <select id="editMateriaAno" class="form-input" required>
                            <option value="">Seleccionar año...</option>
                            <option value="1">1er Año</option>
                            <option value="2">2do Año</option>
                            <option value="3">3er Año</option>
                            <option value="4">4to Año</option>
                            <option value="5">5to Año</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Cuatrimestre</label>
                    <select id="editMateriaCuatrimestre" class="form-input" required>
                        <option value="">Seleccionar cuatrimestre...</option>
                        <option value="1">1er Cuatrimestre</option>
                        <option value="2">2do Cuatrimestre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre de la Materia</label>
                    <input type="text" id="editMateriaNombre" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Materia Correlativa (Opcional)</label>
                    <select id="editMateriaCorrelativa" class="form-input">
                        <option value="">Sin correlativa...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notas de Parciales</label>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Parcial 1 (1-10)</label>
                            <input type="number" id="editMateriaParcial1" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parcial 2 (1-10)</label>
                            <input type="number" id="editMateriaParcial2" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                        </div>
                    </div>
                    <div id="editParcialesExtra"></div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="agregarParcialEdit()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Agregar Parcial
                    </button>
                </div>
                <div class="form-group">
                    <label class="form-label">Exámenes Finales</label>
                    <div id="editFinalesContainer">
                        <div class="form-row" style="margin-bottom: 10px;">
                            <div class="form-group">
                                <label class="form-label">1er Llamado (1-10)</label>
                                <input type="number" id="editMateriaFinal1" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fecha 1er Llamado</label>
                                <input type="date" id="editMateriaFinalFecha1" class="form-input">
                            </div>
                        </div>
                    </div>
                    <div id="editFinalesExtra"></div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="agregarFinalEdit()" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Agregar Llamado
                    </button>
                </div>
                <div class="form-group">
                    <label class="form-label">Comentarios</label>
                    <textarea id="editMateriaComentarios" class="form-input" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editMateriaModal')">Cancelar</button>
                    <button type="submit" class="btn">Actualizar Materia</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        class DataManager {
            static get(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Error loading data:', e);
                    return null;
                }
            }

            static set(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Error saving data:', e);
                    return false;
                }
            }

            static remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.error('Error removing data:', e);
                    return false;
                }
            }
        }

        // App State
        let materias = DataManager.get('materias') || [];
        let tareas = DataManager.get('tareas') || [];
        let horarios = DataManager.get('horarios') || [];
        let examenes = DataManager.get('examenes') || [];

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to selected nav button
            event.target.classList.add('active');

            // Load section-specific data
            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'materias':
                    loadMaterias();
                    break;
                case 'tareas':
                    loadTareas();
                    break;
                case 'examenes':
                    loadExamenes();
                    break;
                case 'horario':
                    loadHorario();
                    break;
                case 'progreso':
                    loadProgreso();
                    break;
            }
        }

        // Modal Functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Load data for dropdowns
            if (modalId === 'tareaModal' || modalId === 'horarioModal' || modalId === 'examenModal') {
                loadMateriasDropdown();
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset forms
            const form = modal.querySelector('form');
            if (form) form.reset();
        }

        // Load materias for dropdowns
        function loadMateriasDropdown() {
            const tareaSelect = document.getElementById('tareaMateria');
            const horarioSelect = document.getElementById('horarioMateria');
            const examenSelect = document.getElementById('examenMateria');
            
            const options = materias.map(materia => 
                `<option value="${materia.id}">${materia.codigo} - ${materia.nombre}</option>`
            ).join('');

            if (tareaSelect) {
                tareaSelect.innerHTML = '<option value="">Seleccionar materia...</option>' + options;
            }
            if (horarioSelect) {
                horarioSelect.innerHTML = '<option value="">Seleccionar materia...</option>' + options;
            }
            if (examenSelect) {
                examenSelect.innerHTML = '<option value="">Seleccionar materia...</option>' + options;
            }

            // También cargar correlativas
            loadCorrelativasDropdown('materiaCorrelativa');
        }

        // Load correlativas dropdown
        function loadCorrelativasDropdown(selectId, excludeId = null) {
            const select = document.getElementById(selectId);
            if (!select) return;

            const availableMaterias = materias.filter(m => m.id !== excludeId);
            const options = availableMaterias.map(materia => 
                `<option value="${materia.id}">${materia.codigo} - ${materia.nombre}</option>`
            ).join('');

            select.innerHTML = '<option value="">Sin correlativa...</option>' + options;
        }

        // Agregar parcial extra
        function agregarParcial() {
            const container = document.getElementById('parcialesExtra');
            const parcialCount = container.children.length + 3; // +3 porque ya hay parcial 1 y 2
            
            const parcialDiv = document.createElement('div');
            parcialDiv.className = 'form-row';
            parcialDiv.style.marginTop = '10px';
            parcialDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Parcial ${parcialCount} (1-10)</label>
                    <input type="number" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(parcialDiv);
        }

        // Agregar parcial extra en edición
        function agregarParcialEdit() {
            const container = document.getElementById('editParcialesExtra');
            const parcialCount = container.children.length + 3; // +3 porque ya hay parcial 1 y 2
            
            const parcialDiv = document.createElement('div');
            parcialDiv.className = 'form-row';
            parcialDiv.style.marginTop = '10px';
            parcialDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Parcial ${parcialCount} (1-10)</label>
                    <input type="number" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(parcialDiv);
        }

        // Agregar final extra
        function agregarFinal() {
            const container = document.getElementById('finalesExtra');
            const finalCount = container.children.length + 2; // +2 porque ya hay 1er llamado
            const llamadoText = finalCount === 2 ? '2do Llamado' : finalCount === 3 ? '3er Llamado' : `${finalCount}° Llamado`;
            
            const finalDiv = document.createElement('div');
            finalDiv.className = 'form-row';
            finalDiv.style.marginTop = '10px';
            finalDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">${llamadoText} (1-10)</label>
                    <input type="number" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha ${llamadoText}</label>
                    <input type="date" class="form-input">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(finalDiv);
        }

        // Agregar final extra en edición
        function agregarFinalEdit() {
            const container = document.getElementById('editFinalesExtra');
            const finalCount = container.children.length + 2; // +2 porque ya hay 1er llamado
            const llamadoText = finalCount === 2 ? '2do Llamado' : finalCount === 3 ? '3er Llamado' : `${finalCount}° Llamado`;
            
            const finalDiv = document.createElement('div');
            finalDiv.className = 'form-row';
            finalDiv.style.marginTop = '10px';
            finalDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">${llamadoText} (1-10)</label>
                    <input type="number" class="form-input" min="1" max="10" step="0.1" placeholder="0.0">
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha ${llamadoText}</label>
                    <input type="date" class="form-input">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(finalDiv);
        }

        // Calcular promedio de materia
        function calcularPromedioMateria(materia) {
            const notas = [];
            
            // Agregar parciales
            if (materia.parcial1) notas.push(materia.parcial1);
            if (materia.parcial2) notas.push(materia.parcial2);
            if (materia.parcialesExtra) {
                materia.parcialesExtra.forEach(parcial => notas.push(parcial));
            }
            
            // Agregar final (usar el último final aprobado o el campo legacy)
            if (materia.finales && materia.finales.length > 0) {
                const finalAprobado = materia.finales.find(f => f.nota >= 4);
                if (finalAprobado) {
                    notas.push(finalAprobado.nota);
                }
            } else if (materia.final && materia.final >= 4) {
                notas.push(materia.final);
            }
            
            if (notas.length === 0) return null;
            
            return notas.reduce((sum, nota) => sum + nota, 0) / notas.length;
        }

        // Obtener estado de materia
        function obtenerEstadoMateria(materia, promedio) {
            // Si no hay notas de parciales, está cursando
            const tieneParciales = materia.parcial1 || materia.parcial2 || (materia.parcialesExtra && materia.parcialesExtra.length > 0);
            if (!tieneParciales) {
                return { texto: 'Cursando', clase: 'cursando' };
            }
            
            // Calcular promedio de parciales solamente
            const notasParciales = [];
            if (materia.parcial1) notasParciales.push(materia.parcial1);
            if (materia.parcial2) notasParciales.push(materia.parcial2);
            if (materia.parcialesExtra) {
                materia.parcialesExtra.forEach(parcial => notasParciales.push(parcial));
            }
            
            const promedioParciales = notasParciales.length > 0 ? 
                notasParciales.reduce((sum, nota) => sum + nota, 0) / notasParciales.length : 0;
            
            // Si el promedio de parciales es menor a 4, está libre
            if (promedioParciales < 4) {
                return { texto: 'Libre', clase: 'libre' };
            }
            
            // Si tiene finales registrados
            if (materia.finales && materia.finales.length > 0) {
                // Buscar si hay algún final aprobado (≥4)
                const finalAprobado = materia.finales.find(f => f.nota >= 4);
                if (finalAprobado) {
                    return { texto: 'Aprobada', clase: 'aprobada' };
                } else {
                    // Si todos los finales están desaprobados, está regular
                    return { texto: 'Regular', clase: 'regular' };
                }
            }
            
            // Si solo tiene final (campo legacy)
            if (materia.final) {
                if (materia.final >= 4) {
                    return { texto: 'Aprobada', clase: 'aprobada' };
                } else {
                    return { texto: 'Regular', clase: 'regular' };
                }
            }
            
            // Si tiene parciales aprobados pero no final, está regular
            return { texto: 'Regular', clase: 'regular' };
        }

        // Daily Motivational Quotes
        function loadDailyQuote() {
            const quotes = {
                0: { text: "¡Domingo de planificación! Prepárate para una semana exitosa", day: "Domingo" },
                1: { text: "¡Lunes de nuevas oportunidades! Hoy podés con todo", day: "Lunes" },
                2: { text: "¡Martes de productividad! Cada línea de código cuenta", day: "Martes" },
                3: { text: "¡Miércoles de persistencia! Estás a mitad de camino", day: "Miércoles" },
                4: { text: "¡Jueves de determinación! El éxito está cerca", day: "Jueves" },
                5: { text: "¡Viernes de logros! Terminá la semana con fuerza", day: "Viernes" },
                6: { text: "¡Sábado de reflexión! Celebrá tus avances", day: "Sábado" }
            };

            const today = new Date().getDay();
            const quote = quotes[today];
            
            document.getElementById('dailyQuote').textContent = quote.text;
            document.getElementById('quoteDay').textContent = quote.day;
        }

        // Dashboard Functions
        function loadDashboard() {
            loadDailyQuote();
            updateStats();
            loadRecentActivity();
        }

        function updateStats() {
            const totalMaterias = materias.length;
            
            // Calcular materias aprobadas usando el nuevo sistema
            const materiasAprobadas = materias.filter(m => {
                const promedio = calcularPromedioMateria(m);
                return promedio !== null && promedio >= 4;
            }).length;
            
            // Calcular promedio general usando el nuevo sistema
            const materiasConPromedio = materias.filter(m => calcularPromedioMateria(m) !== null);
            const promedioGeneral = materiasConPromedio.length > 0 ? 
                (materiasConPromedio.reduce((sum, m) => sum + calcularPromedioMateria(m), 0) / 
                 materiasConPromedio.length).toFixed(1) : '0.0';
            
            const tareasPendientes = tareas.filter(t => !t.completada).length;

            document.getElementById('totalMaterias').textContent = totalMaterias;
            document.getElementById('materiasAprobadas').textContent = materiasAprobadas;
            document.getElementById('promedioGeneral').textContent = promedioGeneral;
            document.getElementById('tareasPendientes').textContent = tareasPendientes;
        }

        function loadRecentActivity() {
            const recentContainer = document.getElementById('recentActivity');
            const recentItems = [];

            // Add recent materias
            materias.slice(-3).forEach(materia => {
                recentItems.push({
                    type: 'materia',
                    text: `Agregaste la materia: ${materia.nombre}`,
                    icon: 'fas fa-book',
                    time: 'Reciente'
                });
            });

            // Add recent tareas
            tareas.slice(-3).forEach(tarea => {
                recentItems.push({
                    type: 'tarea',
                    text: `${tarea.completada ? 'Completaste' : 'Agregaste'} la tarea: ${tarea.nombre}`,
                    icon: tarea.completada ? 'fas fa-check-circle' : 'fas fa-plus-circle',
                    time: 'Reciente'
                });
            });

            if (recentItems.length === 0) {
                recentContainer.innerHTML = `
                    <p style="color: #666; text-align: center; padding: 20px;">
                        No hay actividad reciente. ¡Comienza agregando materias y tareas!
                    </p>
                `;
                return;
            }

            recentContainer.innerHTML = recentItems.slice(-5).map(item => `
                <div style="display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid #f0f0f0;">
                    <i class="${item.icon}" style="color: #a3223a; width: 20px;"></i>
                    <div style="flex: 1;">
                        <p style="margin: 0; font-weight: 500;">${item.text}</p>
                        <small style="color: #666;">${item.time}</small>
                    </div>
                </div>
            `).join('');
        }

        // Materias Functions
        function loadMaterias() {
            const container = document.getElementById('materiasList');
            
            if (materias.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-book" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No hay materias agregadas aún.</p>
                        <p>¡Comienza agregando tu primera materia!</p>
                    </div>
                `;
                return;
            }

            // Sort materias by year, semester, and then alphabetically
            const sortedMaterias = [...materias].sort((a, b) => {
                if (a.ano !== b.ano) {
                    return parseInt(a.ano) - parseInt(b.ano);
                }
                if (a.cuatrimestre !== b.cuatrimestre) {
                    return parseInt(a.cuatrimestre) - parseInt(b.cuatrimestre);
                }
                return a.nombre.localeCompare(b.nombre);
            });

            // Group by year and semester
            const materiasByYearAndSemester = {};
            sortedMaterias.forEach(materia => {
                const key = `${materia.ano}-${materia.cuatrimestre}`;
                if (!materiasByYearAndSemester[key]) {
                    materiasByYearAndSemester[key] = [];
                }
                materiasByYearAndSemester[key].push(materia);
            });

            let html = '';
            Object.keys(materiasByYearAndSemester).sort().forEach(key => {
                const [ano, cuatrimestre] = key.split('-');
                const cuatrimestreText = cuatrimestre === '1' ? '1er Cuatrimestre' : '2do Cuatrimestre';
                
                html += `
                    <div class="year-section" style="grid-column: 1 / -1;">
                        <div class="year-title">
                            <i class="fas fa-calendar-alt"></i>
                            ${ano}° Año - ${cuatrimestreText}
                        </div>
                        <div class="grid grid-3">
                            ${materiasByYearAndSemester[key].map(materia => {
                                const promedio = calcularPromedioMateria(materia);
                                const estado = obtenerEstadoMateria(materia, promedio);
                                const correlativa = materia.correlativaId ? materias.find(m => m.id === materia.correlativaId) : null;
                                
                                return `
                                <div class="materia-item">
                                    <div class="materia-header">
                                        <div>
                                            <div class="materia-code">${materia.codigo}</div>
                                            <div class="materia-name">${materia.nombre}</div>
                                            <div style="margin-top: 5px;">
                                                <span class="estado-materia estado-${estado.clase}">${estado.texto}</span>
                                            </div>
                                        </div>
                                        <div class="materia-note">
                                            ${promedio !== null ? promedio.toFixed(1) : 'Sin notas'}
                                        </div>
                                    </div>
                                    
                                    <div class="materia-details">
                                        <div class="materia-info">
                                            <div class="info-item">
                                                <span class="info-label">Año y Cuatrimestre</span>
                                                <span class="info-value">${materia.ano}° Año - ${materia.cuatrimestre === '1' ? '1er' : '2do'} Cuatrimestre</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Correlativa</span>
                                                <span class="info-value">${correlativa ? `${correlativa.codigo} - ${correlativa.nombre}` : 'Sin correlativa'}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="notas-grid">
                                            ${materia.parcial1 ? `
                                                <div class="nota-item">
                                                    <div class="nota-label">Parcial 1</div>
                                                    <div class="nota-value">${materia.parcial1}</div>
                                                </div>
                                            ` : ''}
                                            ${materia.parcial2 ? `
                                                <div class="nota-item">
                                                    <div class="nota-label">Parcial 2</div>
                                                    <div class="nota-value">${materia.parcial2}</div>
                                                </div>
                                            ` : ''}
                                            ${materia.parcialesExtra ? materia.parcialesExtra.map((parcial, index) => `
                                                <div class="nota-item">
                                                    <div class="nota-label">Parcial ${index + 3}</div>
                                                    <div class="nota-value">${parcial}</div>
                                                </div>
                                            `).join('') : ''}
                                            ${materia.finales ? materia.finales.map((final, index) => {
                                                const llamadoText = final.llamado === 1 ? '1er Llamado' : 
                                                                   final.llamado === 2 ? '2do Llamado' : 
                                                                   final.llamado === 3 ? '3er Llamado' : 
                                                                   `${final.llamado}° Llamado`;
                                                const estadoFinal = final.nota >= 4 ? 'aprobado' : 'desaprobado';
                                                return `
                                                    <div class="nota-item ${estadoFinal === 'desaprobado' ? 'final-desaprobado' : ''}">
                                                        <div class="nota-label">${llamadoText}</div>
                                                        <div class="nota-value">${final.nota}</div>
                                                        ${final.fecha ? `<div style="font-size: 0.6rem; color: #666;">${formatDate(final.fecha)}</div>` : ''}
                                                    </div>
                                                `;
                                            }).join('') : ''}
                                            ${materia.final ? `
                                                <div class="nota-item">
                                                    <div class="nota-label">Final</div>
                                                    <div class="nota-value">${materia.final}</div>
                                                </div>
                                            ` : ''}
                                            ${promedio !== null ? `
                                                <div class="nota-item promedio-final">
                                                    <div class="nota-label">Promedio</div>
                                                    <div class="nota-value">${promedio.toFixed(1)}</div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                    
                                    ${materia.comentarios ? `<p style="color: #666; margin: 15px 0;">${materia.comentarios}</p>` : ''}
                                    
                                    <div class="materia-actions">
                                        <button class="btn btn-small" onclick="editMateria('${materia.id}')">
                                            <i class="fas fa-edit"></i> Editar
                                        </button>
                                        <button class="btn btn-small btn-danger" onclick="deleteMateria('${materia.id}')">
                                            <i class="fas fa-trash"></i> Eliminar
                                        </button>
                                    </div>
                                </div>
                            `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function addMateria(event) {
            event.preventDefault();
            
            // Recopilar parciales extra
            const parcialesExtra = [];
            const parcialesExtraInputs = document.querySelectorAll('#parcialesExtra input');
            parcialesExtraInputs.forEach(input => {
                if (input.value) {
                    parcialesExtra.push(parseFloat(input.value));
                }
            });

            // Recopilar finales
            const finales = [];
            
            // Primer llamado
            const final1Nota = document.getElementById('materiaFinal1').value;
            const final1Fecha = document.getElementById('materiaFinalFecha1').value;
            if (final1Nota) {
                finales.push({
                    llamado: 1,
                    nota: parseFloat(final1Nota),
                    fecha: final1Fecha || null
                });
            }

            // Finales extra
            const finalesExtraRows = document.querySelectorAll('#finalesExtra .form-row');
            finalesExtraRows.forEach((row, index) => {
                const notaInput = row.querySelector('input[type="number"]');
                const fechaInput = row.querySelector('input[type="date"]');
                if (notaInput && notaInput.value) {
                    finales.push({
                        llamado: index + 2,
                        nota: parseFloat(notaInput.value),
                        fecha: fechaInput ? fechaInput.value : null
                    });
                }
            });
            
            const materia = {
                id: generateId(),
                codigo: document.getElementById('materiaCodigo').value,
                ano: document.getElementById('materiaAno').value,
                cuatrimestre: document.getElementById('materiaCuatrimestre').value,
                nombre: document.getElementById('materiaNombre').value,
                correlativaId: document.getElementById('materiaCorrelativa').value || null,
                parcial1: document.getElementById('materiaParcial1').value ? parseFloat(document.getElementById('materiaParcial1').value) : null,
                parcial2: document.getElementById('materiaParcial2').value ? parseFloat(document.getElementById('materiaParcial2').value) : null,
                parcialesExtra: parcialesExtra.length > 0 ? parcialesExtra : null,
                finales: finales.length > 0 ? finales : null,
                comentarios: document.getElementById('materiaComentarios').value || ''
            };

            materias.push(materia);
            DataManager.set('materias', materias);
            
            // Limpiar campos extra
            document.getElementById('parcialesExtra').innerHTML = '';
            document.getElementById('finalesExtra').innerHTML = '';
            
            closeModal('materiaModal');
            loadMaterias();
            updateStats();
            showNotification('Materia agregada correctamente');
        }

        function editMateria(id) {
            const materia = materias.find(m => m.id === id);
            if (!materia) return;

            document.getElementById('editMateriaId').value = materia.id;
            document.getElementById('editMateriaCodigo').value = materia.codigo;
            document.getElementById('editMateriaAno').value = materia.ano || '';
            document.getElementById('editMateriaCuatrimestre').value = materia.cuatrimestre || '';
            document.getElementById('editMateriaNombre').value = materia.nombre;
            document.getElementById('editMateriaCorrelativa').value = materia.correlativaId || '';
            document.getElementById('editMateriaParcial1').value = materia.parcial1 || '';
            document.getElementById('editMateriaParcial2').value = materia.parcial2 || '';
            document.getElementById('editMateriaComentarios').value = materia.comentarios || '';

            // Cargar parciales extra
            const editParcialesExtra = document.getElementById('editParcialesExtra');
            editParcialesExtra.innerHTML = '';
            if (materia.parcialesExtra) {
                materia.parcialesExtra.forEach((parcial, index) => {
                    const parcialDiv = document.createElement('div');
                    parcialDiv.className = 'form-row';
                    parcialDiv.style.marginTop = '10px';
                    parcialDiv.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Parcial ${index + 3} (1-10)</label>
                            <input type="number" class="form-input" min="1" max="10" step="0.1" value="${parcial}">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    editParcialesExtra.appendChild(parcialDiv);
                });
            }

            // Cargar finales
            document.getElementById('editMateriaFinal1').value = '';
            document.getElementById('editMateriaFinalFecha1').value = '';
            
            const editFinalesExtra = document.getElementById('editFinalesExtra');
            editFinalesExtra.innerHTML = '';

            if (materia.finales) {
                materia.finales.forEach((final, index) => {
                    if (index === 0) {
                        // Primer llamado
                        document.getElementById('editMateriaFinal1').value = final.nota || '';
                        document.getElementById('editMateriaFinalFecha1').value = final.fecha || '';
                    } else {
                        // Llamados adicionales
                        const llamadoText = index + 1 === 2 ? '2do Llamado' : index + 1 === 3 ? '3er Llamado' : `${index + 1}° Llamado`;
                        const finalDiv = document.createElement('div');
                        finalDiv.className = 'form-row';
                        finalDiv.style.marginTop = '10px';
                        finalDiv.innerHTML = `
                            <div class="form-group">
                                <label class="form-label">${llamadoText} (1-10)</label>
                                <input type="number" class="form-input" min="1" max="10" step="0.1" value="${final.nota || ''}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fecha ${llamadoText}</label>
                                <input type="date" class="form-input" value="${final.fecha || ''}">
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        editFinalesExtra.appendChild(finalDiv);
                    }
                });
            } else if (materia.final) {
                // Compatibilidad con el campo legacy
                document.getElementById('editMateriaFinal1').value = materia.final;
            }

            // Cargar correlativas disponibles
            loadCorrelativasDropdown('editMateriaCorrelativa', materia.id);

            openModal('editMateriaModal');
        }

        function updateMateria(event) {
            event.preventDefault();
            
            const id = document.getElementById('editMateriaId').value;
            const materiaIndex = materias.findIndex(m => m.id === id);
            
            if (materiaIndex === -1) return;

            // Recopilar parciales extra del formulario de edición
            const parcialesExtra = [];
            const parcialesExtraInputs = document.querySelectorAll('#editParcialesExtra input');
            parcialesExtraInputs.forEach(input => {
                if (input.value) {
                    parcialesExtra.push(parseFloat(input.value));
                }
            });

            // Recopilar finales del formulario de edición
            const finales = [];
            
            // Primer llamado
            const final1Nota = document.getElementById('editMateriaFinal1').value;
            const final1Fecha = document.getElementById('editMateriaFinalFecha1').value;
            if (final1Nota) {
                finales.push({
                    llamado: 1,
                    nota: parseFloat(final1Nota),
                    fecha: final1Fecha || null
                });
            }

            // Finales extra
            const finalesExtraRows = document.querySelectorAll('#editFinalesExtra .form-row');
            finalesExtraRows.forEach((row, index) => {
                const notaInput = row.querySelector('input[type="number"]');
                const fechaInput = row.querySelector('input[type="date"]');
                if (notaInput && notaInput.value) {
                    finales.push({
                        llamado: index + 2,
                        nota: parseFloat(notaInput.value),
                        fecha: fechaInput ? fechaInput.value : null
                    });
                }
            });

            materias[materiaIndex] = {
                ...materias[materiaIndex],
                codigo: document.getElementById('editMateriaCodigo').value,
                ano: document.getElementById('editMateriaAno').value,
                cuatrimestre: document.getElementById('editMateriaCuatrimestre').value,
                nombre: document.getElementById('editMateriaNombre').value,
                correlativaId: document.getElementById('editMateriaCorrelativa').value || null,
                parcial1: document.getElementById('editMateriaParcial1').value ? parseFloat(document.getElementById('editMateriaParcial1').value) : null,
                parcial2: document.getElementById('editMateriaParcial2').value ? parseFloat(document.getElementById('editMateriaParcial2').value) : null,
                parcialesExtra: parcialesExtra.length > 0 ? parcialesExtra : null,
                finales: finales.length > 0 ? finales : null,
                comentarios: document.getElementById('editMateriaComentarios').value || ''
            };

            DataManager.set('materias', materias);
            
            // Limpiar campos extra
            document.getElementById('editParcialesExtra').innerHTML = '';
            document.getElementById('editFinalesExtra').innerHTML = '';
            
            closeModal('editMateriaModal');
            loadMaterias();
            updateStats();
            showNotification('Materia actualizada correctamente');
        }

        function deleteMateria(id) {
            if (!confirm('¿Estás seguro de que quieres eliminar esta materia?')) return;

            materias = materias.filter(m => m.id !== id);
            DataManager.set('materias', materias);
            
            loadMaterias();
            updateStats();
            showNotification('Materia eliminada correctamente');
        }

        // Tareas Functions
        function loadTareas() {
            const container = document.getElementById('tareasList');
            
            if (tareas.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-tasks" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No hay tareas agregadas aún.</p>
                        <p>¡Comienza agregando tu primera tarea!</p>
                    </div>
                `;
                return;
            }

            // Sort tareas by date and completion status
            const sortedTareas = [...tareas].sort((a, b) => {
                if (a.completada !== b.completada) {
                    return a.completada ? 1 : -1;
                }
                return new Date(a.fecha) - new Date(b.fecha);
            });

            container.innerHTML = sortedTareas.map(tarea => {
                const materia = materias.find(m => m.id === tarea.materiaId);
                const isOverdue = new Date(tarea.fecha) < new Date() && !tarea.completada;
                
                return `
                    <div class="task-item ${tarea.completada ? 'completed' : ''}" ${isOverdue ? 'style="border-color: #dc3545;"' : ''}>
                        <div class="task-header">
                            <input type="checkbox" class="task-checkbox" ${tarea.completada ? 'checked' : ''} 
                                   onchange="toggleTarea('${tarea.id}')">
                            <div class="task-name">${tarea.nombre}</div>
                            <div class="task-priority priority-${tarea.prioridad}">${tarea.prioridad.toUpperCase()}</div>
                        </div>
                        <div class="task-meta">
                            <div>
                                <i class="fas fa-book"></i> ${materia ? materia.nombre : 'Materia eliminada'}
                            </div>
                            <div>
                                <i class="fas fa-calendar"></i> ${formatDate(tarea.fecha)}
                                ${isOverdue ? '<span style="color: #dc3545; font-weight: bold;"> (Vencida)</span>' : ''}
                            </div>
                            <button class="btn btn-small btn-danger" onclick="deleteTarea('${tarea.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addTarea(event) {
            event.preventDefault();
            
            const tarea = {
                id: generateId(),
                nombre: document.getElementById('tareaNombre').value,
                materiaId: document.getElementById('tareaMateria').value,
                fecha: document.getElementById('tareaFecha').value,
                prioridad: document.getElementById('tareaPrioridad').value,
                completada: false
            };

            tareas.push(tarea);
            DataManager.set('tareas', tareas);
            
            closeModal('tareaModal');
            loadTareas();
            updateStats();
            showNotification('Tarea agregada correctamente');
        }

        function toggleTarea(id) {
            const tareaIndex = tareas.findIndex(t => t.id === id);
            if (tareaIndex === -1) return;

            tareas[tareaIndex].completada = !tareas[tareaIndex].completada;
            DataManager.set('tareas', tareas);
            
            loadTareas();
            updateStats();
            showNotification(tareas[tareaIndex].completada ? 'Tarea completada' : 'Tarea marcada como pendiente');
        }

        function deleteTarea(id) {
            if (!confirm('¿Estás seguro de que quieres eliminar esta tarea?')) return;

            tareas = tareas.filter(t => t.id !== id);
            DataManager.set('tareas', tareas);
            
            loadTareas();
            updateStats();
            showNotification('Tarea eliminada correctamente');
        }

        // Horario Functions
        function loadHorario() {
            const table = document.getElementById('scheduleTable');
            const days = ['', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            const hours = [];
            
            hours.push('12:00');
            for (let i = 13; i <= 22; i++) {
                hours.push(`${i}:00`);
            }

            // Create header
            let html = '<thead><tr>';
            days.forEach(day => {
                html += `<th>${day}</th>`;
            });
            html += '</tr></thead><tbody>';

            // Create time slots
            hours.forEach(hour => {
                html += '<tr>';
                html += `<td class="time-cell">${hour}</td>`;
                
                days.slice(1).forEach(day => {
                    const dayEvents = horarios.filter(h => h.dia === day.toLowerCase() && h.inicio <= hour && h.fin > hour);
                    html += '<td>';
                    dayEvents.forEach(event => {
                        const materia = materias.find(m => m.id === event.materiaId);
                        html += `
                            <div class="schedule-event" onclick="deleteHorario('${event.id}')">
                                ${materia ? materia.codigo : 'N/A'}
                                ${event.aula ? `<br><small>${event.aula}</small>` : ''}
                            </div>
                        `;
                    });
                    html += '</td>';
                });
                
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function addHorario(event) {
            event.preventDefault();
            
            const horario = {
                id: generateId(),
                materiaId: document.getElementById('horarioMateria').value,
                dia: document.getElementById('horarioDia').value,
                aula: document.getElementById('horarioAula').value || '',
                inicio: document.getElementById('horarioInicio').value,
                fin: document.getElementById('horarioFin').value
            };

            horarios.push(horario);
            DataManager.set('horarios', horarios);
            
            closeModal('horarioModal');
            loadHorario();
            showNotification('Clase agregada al horario');
        }

        function deleteHorario(id) {
            if (!confirm('¿Eliminar esta clase del horario?')) return;

            horarios = horarios.filter(h => h.id !== id);
            DataManager.set('horarios', horarios);
            
            loadHorario();
            showNotification('Clase eliminada del horario');
        }

        // Exámenes Functions
        function loadExamenes() {
            const container = document.getElementById('examenesList');
            
            if (examenes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-clipboard-list" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No hay exámenes registrados aún.</p>
                        <p>¡Comienza registrando tu primer examen!</p>
                    </div>
                `;
                return;
            }

            // Sort exámenes by date (most recent first)
            const sortedExamenes = [...examenes].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            container.innerHTML = sortedExamenes.map(examen => {
                const materia = materias.find(m => m.id === examen.materiaId);
                
                return `
                    <div class="exam-item">
                        <div class="exam-header">
                            <div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    <span class="exam-type ${examen.tipo}">${examen.tipo}</span>
                                    <span style="font-weight: 600; color: #333;">
                                        ${materia ? `${materia.codigo} - ${materia.nombre}` : 'Materia eliminada'}
                                    </span>
                                </div>
                                <div style="color: #666; font-size: 0.9rem;">
                                    <i class="fas fa-calendar"></i> ${formatDate(examen.fecha)}
                                </div>
                            </div>
                            <div class="exam-note">
                                ${examen.nota ? examen.nota : 'Sin nota'}
                            </div>
                        </div>
                        ${examen.observaciones ? `<p style="color: #666; margin-bottom: 15px; font-style: italic;">${examen.observaciones}</p>` : ''}
                        <div class="exam-meta">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <span style="color: ${examen.nota >= 6 ? '#28a745' : examen.nota >= 4 ? '#ffc107' : '#dc3545'}; font-weight: bold;">
                                    ${examen.nota >= 6 ? 'Aprobado' : examen.nota >= 4 ? 'Regular' : examen.nota ? 'Desaprobado' : 'Pendiente'}
                                </span>
                            </div>
                            <button class="btn btn-small btn-danger" onclick="deleteExamen('${examen.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addExamen(event) {
            event.preventDefault();
            
            const examen = {
                id: generateId(),
                materiaId: document.getElementById('examenMateria').value,
                tipo: document.getElementById('examenTipo').value,
                fecha: document.getElementById('examenFecha').value,
                nota: document.getElementById('examenNota').value || null,
                observaciones: document.getElementById('examenObservaciones').value || ''
            };

            examenes.push(examen);
            DataManager.set('examenes', examenes);
            
            closeModal('examenModal');
            loadExamenes();
            updateStats();
            showNotification('Examen registrado correctamente');
        }

        function deleteExamen(id) {
            if (!confirm('¿Estás seguro de que quieres eliminar este examen?')) return;

            examenes = examenes.filter(e => e.id !== id);
            DataManager.set('examenes', examenes);
            
            loadExamenes();
            updateStats();
            showNotification('Examen eliminado correctamente');
        }

        // Progreso Functions
        function loadProgreso() {
            const totalMaterias = materias.length;
            
            // Calcular materias aprobadas usando el nuevo sistema
            const materiasAprobadas = materias.filter(m => {
                const promedio = calcularPromedioMateria(m);
                return promedio !== null && promedio >= 4;
            }).length;
            
            const progreso = totalMaterias > 0 ? Math.round((materiasAprobadas / totalMaterias) * 100) : 0;

            // Update progress bar
            document.getElementById('careerProgress').style.width = `${progreso}%`;
            document.getElementById('progressText').textContent = `${progreso}% completado (${materiasAprobadas}/${totalMaterias} materias)`;

            // Load status distribution
            loadMateriasStatus();
            loadNotasDistribution();
        }

        function loadMateriasStatus() {
            const container = document.getElementById('materiasStatus');
            
            // Usar el nuevo sistema de cálculo
            const aprobadas = materias.filter(m => {
                const promedio = calcularPromedioMateria(m);
                return promedio !== null && promedio >= 4;
            }).length;
            
            const regulares = materias.filter(m => {
                const promedio = calcularPromedioMateria(m);
                return promedio !== null && promedio >= 2 && promedio < 4;
            }).length;
            
            const libres = materias.filter(m => {
                const promedio = calcularPromedioMateria(m);
                return promedio !== null && promedio < 2;
            }).length;
            
            const cursando = materias.filter(m => calcularPromedioMateria(m) === null).length;

            container.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Aprobadas (≥4.0)</span>
                        <span style="font-weight: bold; color: #28a745;">${aprobadas}</span>
                    </div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 8px;">
                        <div style="background: #28a745; height: 100%; border-radius: 10px; width: ${materias.length > 0 ? (aprobadas / materias.length) * 100 : 0}%;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Regulares (2.0-3.9)</span>
                        <span style="font-weight: bold; color: #ffc107;">${regulares}</span>
                    </div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 8px;">
                        <div style="background: #ffc107; height: 100%; border-radius: 10px; width: ${materias.length > 0 ? (regulares / materias.length) * 100 : 0}%;"></div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Libres (<2.0)</span>
                        <span style="font-weight: bold; color: #dc3545;">${libres}</span>
                    </div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 8px;">
                        <div style="background: #dc3545; height: 100%; border-radius: 10px; width: ${materias.length > 0 ? (libres / materias.length) * 100 : 0}%;"></div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Cursando</span>
                        <span style="font-weight: bold; color: #17a2b8;">${cursando}</span>
                    </div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 8px;">
                        <div style="background: #17a2b8; height: 100%; border-radius: 10px; width: ${materias.length > 0 ? (cursando / materias.length) * 100 : 0}%;"></div>
                    </div>
                </div>
            `;
        }

        function loadNotasDistribution() {
            const container = document.getElementById('notasDistribution');
            const materiasConPromedio = materias.filter(m => calcularPromedioMateria(m) !== null);
            
            if (materiasConPromedio.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">No hay promedios calculados aún</p>';
                return;
            }

            const ranges = {
                '9-10': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio >= 9;
                }).length,
                '8-8.9': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio >= 8 && promedio < 9;
                }).length,
                '7-7.9': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio >= 7 && promedio < 8;
                }).length,
                '6-6.9': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio >= 6 && promedio < 7;
                }).length,
                '4-5.9': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio >= 4 && promedio < 6;
                }).length,
                '0-3.9': materiasConPromedio.filter(m => {
                    const promedio = calcularPromedioMateria(m);
                    return promedio < 4;
                }).length
            };

            const colors = ['#28a745', '#17a2b8', '#ffc107', '#fd7e14', '#6f42c1', '#dc3545'];
            let html = '';

            Object.entries(ranges).forEach(([range, count], index) => {
                const percentage = (count / materiasConPromedio.length) * 100;
                html += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${range}</span>
                            <span style="font-weight: bold;">${count}</span>
                        </div>
                        <div style="background: #e9ecef; border-radius: 10px; height: 8px;">
                            <div style="background: ${colors[index]}; height: 100%; border-radius: 10px; width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadDashboard();

            // Form event listeners
            document.getElementById('materiaForm').addEventListener('submit', addMateria);
            document.getElementById('editMateriaForm').addEventListener('submit', updateMateria);
            document.getElementById('tareaForm').addEventListener('submit', addTarea);
            document.getElementById('examenForm').addEventListener('submit', addExamen);
            document.getElementById('horarioForm').addEventListener('submit', addHorario);

            // Modal close on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        closeModal(modal.id);
                    });
                }
            });
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b1d6d5a556e9b4',t:'MTc1NDUxNzk2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
